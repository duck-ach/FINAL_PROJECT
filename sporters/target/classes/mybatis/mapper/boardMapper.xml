<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.sporters.board.mapper.BoardMapper">

	<resultMap type="FreeDTO" id="FreeDtoMap">
		<id property="freeNo"  column="FREE_NO" />
		<result property="title"  column="TITLE" />
		<result property="content"  column="CONTENT" />
		<result property="createDate"  column="CREATE_DATE" />
		<result property="hit"  column="HIT" />
		<result property="userNo"  column="USER_NO" />
		<result property="state"  column="STATE" />
		<result property="ip"  column="IP" />
		<result property="modifyDate"  column="MODIFY_DATE" />	
		<association property="users"  javaType="UsersDTO" >
			<id  property="userNo"  column="USER_NO"  />
			<result property="id"  column="ID" />	
			<result property="nickName"  column="NICKNAME" />	
			<result property="name"  column="NAME" />
			<result property="joinDate"  column="JOINDATE" />
			<result property="gender"  column="GENDER" />
		
		</association>
		
	</resultMap>


<select id="selectFreeListCnt" resultType="int">
		SELECT COUNT(*)
		FROM FREE
	</select>

	<!-- 게시판목록 -->
	<select id="selectFreeList" parameterType="Map" resultMap="FreeDtoMap">
		SELECT A.ROW_NUM, A.FREE_NO, A.TITLE, A.CONTENT, A.CREATE_DATE,  A.HIT,A.USER_NO, A.STATE,  A.IP, A.MODIFY_DATE, A.ID, A.NICKNAME, A.GENDER
		  FROM (SELECT ROW_NUMBER() OVER(ORDER BY FREE_NO DESC) AS ROW_NUM, F.FREE_NO, F.TITLE, F.CONTENT, F.CREATE_DATE,  F.HIT, F.USER_NO , F.STATE, F.IP, F.MODIFY_DATE, U.ID, U.NICKNAME, U.GENDER
		  		  FROM FREE F INNER JOIN USERS U
		     	    ON F.USER_NO = U.USER_NO) A
		 WHERE A.ROW_NUM BETWEEN #{begin} AND #{end}
	</select>
	
<!-- 게시판 삽입(첨부파일 추가) -->
	<insert id="insertFree" parameterType="FreeDTO">
		INSERT INTO FREE
			(FREE_NO, TITLE, CONTENT,CREATE_DATE, HIT,USER_NO,STATE,IP,MODIFY_DATE)
		VALUES
			(FREE_SEQ.NEXTVAL, #{title}, #{content}, SYSDATE, 0,#{userNo}, 0, #{ip}, SYSDATE)
	</insert>
	
	<!-- 이미지 삽입 -->
	<insert id="insertSummernoteImage" parameterType="ImageDTO">
		INSERT INTO IMAGE
			(IMAGE_NO,FREE_NO, FILESYSTEM)
		VALUES
			( IMAGE_SEQ.NEXTVAL, #{freeNo}, #{filesystem})						
	</insert>



	<!-- 상세보기 -->
	<select id="selectGalleryByNo" parameterType="int" resultType="FreeDTO">
	  SELECT FREE_NO, TITLE, CONTENT, CREATE_DATE, HIT, USER_NO, STATE,IP,MODIFY_DATE
	  FROM FREE
	  WHERE FREE_NO = #{freeNo}
	</select>
	
		<!-- 상세보기(조회수) -->
	<update id="updateHit" parameterType="int">
		UPDATE FREE
		   SET HIT = HIT + 1
		 WHERE FREE_NO = #{freeNo}
	</update>





	
</mapper>