<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.sporters.shopAdmin.mapper.ShopAdminOrderMapper">

	<!-- 주문 + 유저 resultMap -->
	<resultMap type="OrderDTO" id="OrderMap">
		<id property="orderNo" column="ORDER_NO" />
		<result property="userNo" column="USER_NO"/>
		<result property="cartNo" column="CART_NO"/>
		<result property="payment" column="PAYMENT"/>
		<result property="name" column="NAME"/>
		<result property="mobile" column="MOBILE"/>
		<result property="stock" column="STOCK"/>
		<result property="postCode" column="POST_CODE"/>
		<result property="loadAddress" column="LOAD_ADDRESS"/>
		<result property="jibunAddress" column="JIBUN_ADDRESS"/>
		<result property="detailAddress" column="DETAIL_ADDRESS"/>
		<result property="orderDate" column="ORDER_DATE"/>
		<association property="users" javaType="UsersDTO">
			<id property="userNo" column="USER_NO"/>
			<result property="id" column="ID"/>
			<result property="name" column="NAME"/>
			<result property="gender" column="GENDER"/>
			<result property="email" column="EMAIL"/>
			<result property="mobile" column="MOBILE"/>
			<result property="postcode" column="POSTCODE"/>
			<result property="roadAddress" column="ROAD_ADDRESS"/>
			<result property="jibunAddress" column="JIBUN_ADDRESS"/>
			<result property="detailAddress" column="DETAIL_ADDRESS"/>
		</association>
	</resultMap>
	
		<resultMap type="cartDTO" id="CartMap">
			<id property="cartNo" column="CART_NO" />
			<result property="userNo" column="USER_NO"/>
			<result property="prodNo" column="PROD_NO"/>
			<result property="prodCnt" column="PROD_CNT"/>
			<association property="product" javaType="ProductDTO">
				<id property="prodNo" column="PROD_NO" />
				<result property="prodName" column="PROD_NAME"/>
				<result property="price" column="PRICE"/>
				<result property="stock" column="STOCK"/>
			</association>
		</resultMap>	
	
	
	<!-- 주문목록 -->
	<select id="selectOrderList" resultMap="OrderMap">
		SELECT O.ORDER_NO, U.NAME, O.NAME, O.MOBILE, O.ORDER_DATE
		  FROM ORDERS O LEFT OUTER JOIN USERS U
		    ON O.USER_NO = U.USER_NO
		 ORDER BY O.ORDER_NO
	</select>
	
	<!-- 주문한 상품목록 -->
	<select id="selectCartList" resultMap="CartMap" parameterType="map">
		SELECT C.CART_NO, C.USER_NO, C.PROD_NO, C.PROD_CNT, P.PROD_NAME, P.PRICE, P.STOCK
		  FROM CART C INNER JOIN PRODUCT P
		    ON C.PROD_NO = P.PROD_NO
		 WHERE C.CART_NO = #{cartNo}
	</select>

	<!-- 상품 가격 -->
	<select id="selectProdAllPrice" resultType="CartDTO" parameterType="map">
		SELECT C.PROD_CNT, P.PRICE
		  FROM CART C INNER JOIN PRODUCT P
		 	ON C.PROD_NO = P.PROD_NO
		 WHERE C.CART_NO = #{cartNo}
	</select>

</mapper>